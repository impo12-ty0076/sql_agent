# Requirements Document: SQL DB LLM Agent System

## Introduction

본 시스템은 비전문가도 자연어로 MS-SQL 및 SAP HANA DB에 질의하고,
쿼리 결과를 표, 자연어 요약, 또는 AI 기반 파이썬 리포트(토글 방식)로 얻을 수 있는
웹 기반 LLM 에이전트 서비스입니다. 이 시스템은 데이터베이스 전문 지식이 없는 사용자도
자연어로 복잡한 데이터 분석을 수행할 수 있게 하여 데이터 기반 의사결정을 지원합니다.

## Requirements

### 1. 사용자 인증 및 접근 관리

**User Story:** 사용자로서, 나는 안전하게 시스템에 로그인하고 권한에 맞는 DB에 접근하고 싶다. 그래서 내 데이터에 안전하게 접근할 수 있다.

#### Acceptance Criteria

1. WHEN 사용자가 로그인 페이지에 접속 THEN 시스템은 사용자명과 비밀번호 입력 폼을 제공해야 한다.
2. WHEN 사용자가 올바른 인증 정보를 제공 THEN 시스템은 사용자를 인증하고 메인 대시보드로 리디렉션해야 한다.
3. WHEN 사용자가 잘못된 인증 정보를 제공 THEN 시스템은 적절한 오류 메시지를 표시해야 한다.
4. WHEN 인증된 사용자가 접근 권한이 없는 DB에 접근 시도 THEN 시스템은 접근 거부 메시지를 표시해야 한다.
5. WHEN 사용자 세션이 60분 동안 비활성 상태 THEN 시스템은 자동으로 로그아웃해야 한다.

### 2. 데이터베이스 연결 및 선택

**User Story:** 사용자로서, 나는 접근 가능한 여러 데이터베이스 중에서 선택하여 연결하고 싶다. 그래서 필요한 데이터에 쉽게 접근할 수 있다.

#### Acceptance Criteria

1. WHEN 인증된 사용자가 대시보드에 접속 THEN 시스템은 사용자가 접근 권한을 가진 DB 목록(MS-SQL, SAP HANA)을 표시해야 한다.
2. WHEN 사용자가 DB를 선택 THEN 시스템은 해당 DB에 연결하고 연결 상태를 표시해야 한다.
3. WHEN DB 연결에 실패 THEN 시스템은 구체적인 오류 원인과 해결 방법을 제안해야 한다.
4. WHEN 사용자가 DB 연결 후 다른 DB로 전환 요청 THEN 시스템은 현재 연결을 종료하고 새 DB에 연결해야 한다.
5. IF 사용자가 최근 연결했던 DB가 있다면 THEN 시스템은 다음 로그인 시 해당 DB를 기본 선택으로 제안해야 한다.

### 3. 자연어 질의 처리

**User Story:** 비기술적 사용자로서, 나는 SQL을 모르더라도 자연어로 데이터를 질의하고 싶다. 그래서 복잡한 쿼리 언어를 배우지 않고도 데이터 분석을 할 수 있다.

#### Acceptance Criteria

1. WHEN 사용자가 자연어로 질의 입력 THEN 시스템은 이를 적절한 SQL 쿼리로 변환해야 한다.
2. WHEN 시스템이 자연어를 SQL로 변환 THEN 실행 전 사용자에게 생성된 SQL을 표시하고 대체 옵션(RAG 시스템 사용)을 제공해야 한다.
3. WHEN 사용자가 RAG 시스템 옵션 선택 THEN 시스템은 키워드 기반 검색을 통해 관련 데이터를 검색하고 결과를 제공해야 한다.
4. WHEN RAG 시스템이 관련 데이터 검색 THEN 시스템은 검색된 데이터를 기반으로 사용자 질의에 대한 응답을 생성해야 한다.
5. WHEN 자연어 질의가 모호하거나 불완전 THEN 시스템은 명확화를 위한 추가 질문을 제시해야 한다.
6. WHEN 사용자가 이전 질의를 참조하는 후속 질문 입력 THEN 시스템은 대화 컨텍스트를 유지하며 적절히 응답해야 한다.
7. WHEN 자연어 질의에 테이블이나 필드명이 명시적으로 언급되지 않음 THEN 시스템은 DB 스키마를 분석하여 관련 테이블과 필드를 추론해야 한다.

### 4. SQL 쿼리 생성 및 실행

**User Story:** 사용자로서, 나는 내 질문이 정확한 SQL로 변환되어 안전하게 실행되길 원한다. 그래서 신뢰할 수 있는 결과를 얻을 수 있다.

#### Acceptance Criteria

1. WHEN 시스템이 SQL 쿼리 생성 THEN DB 구조 정보(테이블, 필드, 관계)를 활용하여 최적화된 쿼리를 생성해야 한다.
2. WHEN SQL 쿼리 실행 THEN 시스템은 읽기 전용 모드로만 실행하여 데이터 변경을 방지해야 한다.
3. WHEN 생성된 쿼리가 DDL, DML 문을 포함 THEN 시스템은 실행을 거부하고 경고 메시지를 표시해야 한다.
4. WHEN 쿼리 실행 시간이 10초 초과 THEN 시스템은 진행 상태를 표시하고 취소 옵션을 제공해야 한다.
5. WHEN 쿼리가 대량의 데이터(10,000행 초과)를 반환 THEN 시스템은 페이지네이션을 적용하고 데이터 샘플만 표시해야 한다.
6. IF 쿼리가 MS-SQL과 SAP HANA 간 문법 차이가 있는 기능 사용 THEN 시스템은 대상 DB에 맞게 문법을 자동 조정해야 한다.

### 5. 결과 표시 및 분석

**User Story:** 데이터 분석가로서, 나는 쿼리 결과를 다양한 형식(표, 요약, 시각화)으로 보고 싶다. 그래서 데이터에서 인사이트를 쉽게 도출할 수 있다.

#### Acceptance Criteria

1. WHEN 쿼리 실행 완료 THEN 시스템은 결과를 표 형식으로 표시하고 정렬, 필터링 기능을 제공해야 한다.
2. WHEN 사용자가 자연어 요약 요청 THEN 시스템은 쿼리 결과의 주요 인사이트를 자연어로 요약해야 한다.
3. WHEN 사용자가 "리포트 생성" 토글 활성화 THEN 시스템은 파이썬 인터프리터를 통해 pandas, matplotlib 등으로 데이터 분석 및 시각화를 수행해야 한다.
4. WHEN 리포트 생성 중 THEN 시스템은 실시간 진행 상태를 표시해야 한다.
5. WHEN 리포트 생성 완료 THEN 시스템은 시각화 결과와 분석 인사이트를 포함한 리포트를 표시하고 다운로드 옵션을 제공해야 한다.
6. IF 데이터가 시계열 특성을 가짐 THEN 시스템은 시계열 분석 및 적절한 시각화(선 그래프, 추세선 등)를 제공해야 한다.

### 6. 이력 관리 및 공유

**User Story:** 팀 구성원으로서, 나는 이전 쿼리와 결과를 저장하고 팀과 공유하고 싶다. 그래서 협업 효율성을 높이고 중복 작업을 줄일 수 있다.

#### Acceptance Criteria

1. WHEN 쿼리 실행 완료 THEN 시스템은 자동으로 질의, SQL, 결과를 이력에 저장해야 한다.
2. WHEN 사용자가 이력 페이지 접속 THEN 시스템은 날짜, 쿼리 유형별로 필터링 가능한 이력 목록을 표시해야 한다.
3. WHEN 사용자가 이력에서 항목 선택 THEN 시스템은 원본 질의, SQL, 결과를 복원하고 재실행 옵션을 제공해야 한다.
4. WHEN 사용자가 쿼리/결과 공유 요청 THEN 시스템은 접근 권한을 가진 사용자와 공유 가능한 링크를 생성해야 한다.
5. WHEN 공유 링크로 접근 THEN 시스템은 접근 권한 확인 후 해당 쿼리/결과를 표시해야 한다.

### 7. 오류 처리 및 피드백

**User Story:** 사용자로서, 나는 오류 발생 시 명확한 설명과 해결 방법을 알고 싶다. 그래서 문제를 빠르게 해결하고 작업을 계속할 수 있다.

#### Acceptance Criteria

1. WHEN DB 연결 오류 발생 THEN 시스템은 구체적인 오류 원인(네트워크, 인증, 권한 등)과 해결 방법을 제시해야 한다.
2. WHEN SQL 변환 또는 실행 오류 발생 THEN 시스템은 오류 위치와 원인을 강조 표시하고 수정 제안을 제공해야 한다.
3. WHEN LLM 서비스 장애 발생 THEN 시스템은 대체 LLM으로 전환하거나 기본 SQL 편집기 모드를 제공해야 한다.
4. WHEN 사용자가 피드백 제출 THEN 시스템은 이를 로깅하고 관리자에게 알림을 전송해야 한다.
5. WHEN 동일한 오류가 반복 발생 THEN 시스템은 패턴을 감지하고 근본 원인 해결을 위한 제안을 제공해야 한다.

### 8. 관리자 기능

**User Story:** 시스템 관리자로서, 나는 사용 현황을 모니터링하고 보안 정책을 관리하고 싶다. 그래서 시스템의 안정성과 보안을 유지할 수 있다.

#### Acceptance Criteria

1. WHEN 관리자가 관리 콘솔 접속 THEN 시스템은 사용자별, DB별 사용 통계와 오류 로그를 대시보드로 표시해야 한다.
2. WHEN 관리자가 사용자 권한 설정 THEN 시스템은 사용자별로 접근 가능한 DB와 테이블을 지정할 수 있어야 한다.
3. WHEN 관리자가 쿼리 제한 정책 설정 THEN 시스템은 사용자별 일일 쿼리 수, 최대 실행 시간, 결과 크기 제한을 적용해야 한다.
4. WHEN 관리자가 DB 연결 정보 또는 LLM API 키 업데이트 THEN 시스템은 이를 안전하게 암호화하여 저장해야 한다.
5. WHEN 보안 위반 시도 감지 THEN 시스템은 즉시 관리자에게 알림을 전송하고 해당 사용자 계정을 일시 중지해야 한다.
6. WHEN 관리자가 시스템 백업 요청 THEN 시스템은 설정, 사용자 데이터, 쿼리 이력의 백업을 생성해야 한다.

### 9. 성능 및 확장성

**User Story:** 시스템 운영자로서, 나는 시스템이 증가하는 사용자 수와 데이터 양에도 안정적으로 작동하길 원한다. 그래서 서비스 품질을 일관되게 유지할 수 있다.

#### Acceptance Criteria

1. WHEN 동시 사용자 50명 이상 접속 THEN 시스템은 응답 시간 저하 없이 요청을 처리해야 한다.
2. WHEN 단일 쿼리가 1GB 이상의 결과 반환 THEN 시스템은 메모리 효율적인 방식으로 처리하고 스트리밍 응답을 제공해야 한다.
3. WHEN 신규 DB 유형 추가 필요 THEN 시스템은 코어 아키텍처 변경 없이 새 DB 커넥터 모듈을 추가할 수 있어야 한다.
4. WHEN 신규 LLM 서비스 추가 필요 THEN 시스템은 표준 인터페이스를 통해 새 LLM을 통합할 수 있어야 한다.
5. WHEN 시스템 부하가 임계치 초과 THEN 시스템은 자동으로 리소스를 확장하거나 요청을 큐에 넣어 순차적으로 처리해야 한다.

### 10. 보안 및 규정 준수

**User Story:** 보안 책임자로서, 나는 시스템이 데이터 보호 규정을 준수하고 보안 위협에 대응하길 원한다. 그래서 민감한 기업 데이터를 안전하게 보호할 수 있다.

#### Acceptance Criteria

1. WHEN 민감 정보 저장 THEN 시스템은 업계 표준 암호화(AES-256 이상)를 사용해야 한다.
2. WHEN 사용자 인증 처리 THEN 시스템은 다중 인증(MFA) 옵션을 제공해야 한다.
3. WHEN 외부 API와 통신 THEN 시스템은 TLS 1.3 이상을 사용한 암호화된 연결을 사용해야 한다.
4. WHEN 개인정보 처리 THEN 시스템은 GDPR, CCPA 등 관련 데이터 보호법을 준수해야 한다.
5. WHEN 보안 감사 요청 THEN 시스템은 모든 접근 및 작업에 대한 상세 감사 로그를 제공해야 한다.
6. WHEN 보안 취약점 발견 THEN 시스템은 정기적인 보안 패치 및 업데이트를 적용해야 한다.

## System Requirements

- [SR-01] 지원 DB: MS-SQL Server 2012 이상, SAP HANA 1.0 이상
- [SR-02] DB 커넥터: pyodbc/pymssql, hdbcli 등 공식 드라이버 사용
- [SR-03] LLM: OpenAI GPT-4 이상, Azure OpenAI, Hugging Face 등 연동 지원
- [SR-04] 웹 서버: Node.js 또는 Python 기반 웹 프레임워크(Express, FastAPI 등)
- [SR-05] 프론트엔드: 모던 JavaScript 프레임워크
- [SR-06] 지원 브라우저: Chrome/Edge/Safari/Firefox 최신 버전 (IE 지원 제외)
- [SR-07] 최소 서버 사양: 8코어 CPU, 16GB RAM, 100GB SSD
- [SR-08] 네트워크: DB 서버와 안정적인 연결, 최소 100Mbps 대역폭
- [SR-09] 배포: 고려하지 않아도 됨. MVP 모델임.
- [SR-10] 모니터링: 배포: 고려하지 않아도 됨. MVP 모델임.